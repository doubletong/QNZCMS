window.elFinderSupportVer1=function(e){"use strict";function h(e){return e.replace("Today",a).replace("Yesterday",t)}var r,a,t,i=this;r=new Date,a=r.getFullYear()+"/"+(r.getMonth()+1)+"/"+r.getDate(),r=new Date(Date.now()-864e5),t=r.getFullYear()+"/"+(r.getMonth()+1)+"/"+r.getDate(),this.upload=e||"auto",this.init=function(e){this.fm=e,this.fm.parseUploadData=function(e){var r;if(!$.trim(e))return{error:["errResponse","errDataEmpty"]};try{r=JSON.parse(e)}catch(e){return{error:["errResponse","errDataNotJSON"]}}return i.normalize("upload",r)}},this.send=function(a){var r,e,t=this,i=this.fm,n=$.Deferred(),d=a.data.cmd,s={};switch(n.abort=function(){"pending"==e.state()&&(e.quiet=!0,e.abort())},d){case"open":a.data.tree=1;break;case"parents":case"tree":return n.resolve({tree:[]});case"get":a.data.cmd="read",a.data.current=i.file(a.data.target).phash;break;case"put":a.data.cmd="edit",a.data.current=i.file(a.data.target).phash;break;case"archive":case"rm":a.data.current=i.file(a.data.targets[0]).phash;break;case"extract":case"rename":case"resize":a.data.current=i.file(a.data.target).phash;break;case"duplicate":return s=$.extend(!0,{},a),$.each(a.data.targets,function(e,r){$.ajax(Object.assign(s,{data:{cmd:"duplicate",target:r,current:i.file(r).phash}})).fail(function(e){i.error(i.res("error","connect"))}).done(function(e){(e=t.normalize("duplicate",e)).error?i.error(e.error):e.added&&i.trigger("add",{added:e.added})})}),n.resolve({});case"mkdir":case"mkfile":a.data.current=a.data.target;break;case"paste":a.data.current=a.data.dst,a.data.tree||$.each(a.data.targets,function(e,r){if(i.file(r)&&"directory"===i.file(r).mime)return!(a.data.tree="1")});break;case"size":case"search":return n.resolve({error:i.res("error","cmdsupport")});case"file":a.data.cmd="open",a.data.current=i.file(a.data.target).phash}return e=$.ajax(a).fail(function(e){n.reject(e)}).done(function(e){r=t.normalize(d,e),n.resolve(r)}),n},this.normalize=function(e,i){function a(e){return $.grep(e,function(e){return!(!e||!e.mime||"directory"!==e.mime)})}var n,r,t,d,s=this,o=this.fm,c={};return"tmb"==e||"get"==e?i:("upload"==e&&i.error&&i.cwd&&(i.warning=Object.assign({},i.error),i.error=!1),i.error?i:"put"==e?(n=o.file(i.target.hash).phash,{changed:[this.normalizeFile(i.target,n)]}):(t=(n=i.cwd.hash)==o.cwd().hash,i.tree&&$.each(this.normalizeTree(i.tree),function(e,r){c[r.hash]=r}),$.each(i.cdc||[],function(e,r){var a,t=r.hash;c[t]?(r.date&&((a=Date.parse(h(r.date)))&&!isNaN(a)?c[t].ts=Math.floor(a/1e3):c[t].date=r.date||o.formatDate(r)),c[t].locked=r.hash==n||void 0!==r.rm&&!r.rm):c[t]=s.normalizeFile(r,n,i.tmb)}),i.tree||$.each(o.files(),function(e,r){c[e]||r.phash==n||"directory"!=r.mime||(c[e]=r)}),"open"==e?{cwd:c[n]||this.normalizeFile(i.cwd),files:$.map(c,function(e){return e}),options:s.normalizeOptions(i),init:!!i.params,debug:i.debug}:(t?r=o.diff($.map(c,function(e){return e&&e.hash&&e.name&&e.mime?e:null})):i.tree&&"paste"!==e?r=function(e){var r=a(e);if((d=o.diff(r,null,["date","ts"])).added.length&&(d.added=a(d.added)),d.changed.length&&(d.changed=a(d.changed)),d.removed.length){var t=[];$.each(d.removed,function(e,r){var a;(a=o.file(r))&&"directory"===a.mime&&t.push(r)}),d.removed=t}return d}(c):(r={added:[],removed:[],changed:[]},"paste"===e&&(r.sync=!0)),Object.assign({current:i.cwd.hash,error:i.error,warning:i.warning,options:{tmb:!!i.tmb}},r))))},this.normalizeTree=function(e){var i=this,n=[],d=function(e,r){var a,t;for(a=0;a<e.length;a++)t=e[a],n.push(i.normalizeFile(t,r)),t.dirs.length&&d(t.dirs,t.hash)};return d([e]),n},this.normalizeFile=function(e,r,a){var t=e.mime||"directory",i="directory"!=t||e.linkTo?e.size:0,n=e.date?Date.parse(h(e.date)):void 0,d={url:e.url,hash:e.hash,phash:r,name:e.name,mime:t,ts:e.ts,size:i,read:e.read,write:e.write,locked:!r||void 0!==e.rm&&!e.rm};return d.ts||(n&&!isNaN(n)?d.ts=Math.floor(n/1e3):d.date=e.date||this.fm.formatDate(e)),"application/x-empty"!=e.mime&&"inode/x-empty"!=e.mime||(d.mime="text/plain"),e.linkTo&&(d.alias=e.linkTo),e.linkTo&&(d.linkTo=e.linkTo),e.tmb?d.tmb=e.tmb:0===d.mime.indexOf("image/")&&a&&(d.tmb=1),e.dirs&&e.dirs.length&&(d.dirs=!0),e.dim&&(d.dim=e.dim),e.resize&&(d.resize=e.resize),d},this.normalizeOptions=function(e){var r={path:e.cwd.rel,disabled:$.merge(e.disabled||[],["search","netmount","zipdl"]),tmb:!!e.tmb,copyOverwrite:!0};return e.params&&(r.api=1,r.url=e.params.url,r.archivers={create:e.params.archives||[],extract:e.params.extract||[]}),-1!==r.path.indexOf("/")?r.separator="/":-1!==r.path.indexOf("\\")&&(r.separator="\\"),r}};